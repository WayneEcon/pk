# 08_heterogeneity_analysis: ç½‘ç»œç»“æ„å¼‚è´¨æ€§åˆ†ææ¨¡å—

## ğŸ¯ æ¨¡å—æ¦‚è¿°

æœ¬æ¨¡å—æ˜¯èƒ½æºç½‘ç»œåˆ†æé¡¹ç›®çš„é‡è¦è¡¥å……ç« èŠ‚ï¼Œä¸“é—¨ç ”ç©¶**åŒå‘åŠ¨æ€é”å®šæ•ˆåº”(DLI)çš„ç½‘ç»œç»“æ„å¼‚è´¨æ€§**ã€‚é€šè¿‡å¼•å…¥äº¤äº’é¡¹åˆ†æï¼Œæ¢ç©¶DLIæ•ˆåº”å¦‚ä½•å› ç½‘ç»œæ‹“æ‰‘ç»“æ„çš„ä¸åŒè€Œè¡¨ç°å‡ºå¼‚è´¨æ€§ç‰¹å¾ã€‚

### æ ¸å¿ƒç ”ç©¶é—®é¢˜

**Q1 (å…¨å±€å¼‚è´¨æ€§)**: DLIå¯¹ç½‘ç»œéŸ§æ€§çš„å› æœæ•ˆåº”ï¼Œæ˜¯å¦åœ¨ä¸€ä¸ªæ›´ç¨ å¯†ã€æ›´é›†èšã€æˆ–æ›´ä¸­å¿ƒåŒ–çš„ç½‘ç»œä¸­è¡¨ç°å¾—æ›´å¼ºæˆ–æ›´å¼±ï¼Ÿ

**Q2 (å±€éƒ¨å¼‚è´¨æ€§)**: ä¸€ä¸ªè´¸æ˜“å…³ç³»ï¼ˆå›½å®¶å¯¹ï¼‰çš„é”å®šæ•ˆåº”ï¼Œæ˜¯å¦ä¼šå› å…¶è´¸æ˜“åŒæ–¹åœ¨ç½‘ç»œä¸­çš„é‡è¦æ€§ï¼ˆå³èŠ‚ç‚¹ä¸­å¿ƒæ€§ï¼‰è€Œå¾—åˆ°æ”¾å¤§æˆ–ç¼©å°ï¼Ÿ

---

## ğŸ—ï¸ æ¨¡å—ç»“æ„

```
08_heterogeneity_analysis/
â”œâ”€â”€ main.py                 # ä¸»æ‰§è¡Œè„šæœ¬ï¼Œå®Œæ•´åˆ†ææµç¨‹
â”œâ”€â”€ data_loader.py          # æ•°æ®åŠ è½½ä¸é¢„å¤„ç†
â”œâ”€â”€ analysis.py             # æ ¸å¿ƒå›å½’åˆ†æåŠŸèƒ½
â”œâ”€â”€ visualizer.py           # å¯è§†åŒ–å›¾è¡¨ç”Ÿæˆ
â”œâ”€â”€ outputs/                # åˆ†æç»“æœè¾“å‡ºç›®å½•
â”‚   â”œâ”€â”€ tables/             # å›å½’ç»“æœè¡¨æ ¼
â”‚   â”‚   â”œâ”€â”€ heterogeneity_results.csv
â”‚   â”‚   â”œâ”€â”€ significant_interactions.json
â”‚   â”‚   â””â”€â”€ full_regression_results.json
â”‚   â””â”€â”€ figures/            # å¯è§†åŒ–å›¾è¡¨
â”‚       â”œâ”€â”€ interaction_heatmap.png
â”‚       â”œâ”€â”€ significance_overview.png
â”‚       â”œâ”€â”€ marginal_effect_*.png
â”‚       â””â”€â”€ diagnostics_*.png
â””â”€â”€ README.md               # æœ¬æ–‡æ¡£
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ç”¨æ³•

```bash
# å¿«é€Ÿæ¼”ç¤ºæ¨¡å¼ï¼ˆæ¨èé¦–æ¬¡ä½¿ç”¨ï¼‰
python main.py --mode demo

# å®Œæ•´åˆ†ææ¨¡å¼
python main.py --mode full

# æŒ‡å®šè¾“å‡ºç›®å½•
python main.py --mode demo --output-dir my_analysis
```

### é«˜çº§ç”¨æ³•

```bash
# ä½¿ç”¨é…ç½®æ–‡ä»¶
python main.py --mode full --config config.json --output-dir results
```

é…ç½®æ–‡ä»¶ç¤ºä¾‹ (`config.json`):
```json
{
    "dli_vars": ["dli_composite", "dli_import", "dli_export"],
    "global_vars": ["global_density", "global_transitivity", "global_efficiency"],
    "local_vars": ["betweenness_centrality", "degree_centrality", "pagerank_centrality"],
    "control_vars": ["control_var1", "control_var2"]
}
```

---

## ğŸ“Š æ•°æ®è¾“å…¥

æœ¬æ¨¡å—æ•´åˆæ¥è‡ªé¡¹ç›®å…¶ä»–æ¨¡å—çš„æ•°æ®ï¼š

### å¿…éœ€æ•°æ®æº

1. **DLIæ•ˆåº”æŒ‡æ ‡** (æ¥è‡ª `04_dli_analysis`)
   - DLIå¤åˆæŒ‡æ•°
   - è¿›å£é”å®šæŒ‡æ•°
   - å‡ºå£é”å®šæŒ‡æ•°

2. **å…¨å±€ç½‘ç»œæŒ‡æ ‡** (æ¥è‡ª `03_metrics`)
   - ç½‘ç»œå¯†åº¦ (density)
   - ä¼ é€’æ€§ (transitivity)
   - å¹³å‡èšç±»ç³»æ•° (clustering)
   - ç½‘ç»œæ•ˆç‡ (efficiency)

3. **å±€éƒ¨èŠ‚ç‚¹æŒ‡æ ‡** (æ¥è‡ª `03_metrics`)
   - åº¦ä¸­å¿ƒæ€§ (degree centrality)
   - ä»‹æ•°ä¸­å¿ƒæ€§ (betweenness centrality)
   - ç‰¹å¾å‘é‡ä¸­å¿ƒæ€§ (eigenvector centrality)
   - PageRankä¸­å¿ƒæ€§

4. **å› æœåˆ†æåŸºå‡†æ•°æ®** (æ¥è‡ª `05_causal_validation`)
   - ç½‘ç»œéŸ§æ€§æŒ‡æ ‡
   - æ§åˆ¶å˜é‡
   - é¢æ¿æ•°æ®ç»“æ„

### æ•°æ®è‡ªåŠ¨æ£€æµ‹

å¦‚æœæ‰¾ä¸åˆ°çœŸå®æ•°æ®æ–‡ä»¶ï¼Œæ¨¡å—ä¼šè‡ªåŠ¨ç”Ÿæˆç¤ºä¾‹æ•°æ®ä»¥ç¡®ä¿ç¨‹åºæ­£å¸¸è¿è¡Œã€‚

---

## ğŸ”¬ åˆ†ææ–¹æ³•

### å›å½’æ¨¡å‹è®¾è®¡

æœ¬åˆ†æåŸºäº `05_causal_validation` çš„åŸºå‡†å›å½’æ¨¡å‹ï¼Œå¼•å…¥äº¤äº’é¡¹è¿›è¡Œå¼‚è´¨æ€§æ£€éªŒï¼š

#### å…¨å±€å¼‚è´¨æ€§æ¨¡å‹
```
Y ~ DLI + Global_Metric + DLI Ã— Global_Metric + Controls
```

#### å±€éƒ¨å¼‚è´¨æ€§æ¨¡å‹  
```
Y ~ DLI + Local_Metric + DLI Ã— Local_Metric + Controls
```

### ç»Ÿè®¡æ–¹æ³•

- **ä¸»è¦æ–¹æ³•**: OLSå›å½’åˆ†æ (ä½¿ç”¨statsmodels)
- **äº¤äº’æ•ˆåº”**: è®¡ç®—è¾¹é™…æ•ˆåº”å’Œæ¡ä»¶æ•ˆåº”
- **æ¨¡å‹è¯Šæ–­**: æ®‹å·®åˆ†æã€å¼‚æ–¹å·®æ£€éªŒã€å¤šé‡å…±çº¿æ€§æ£€éªŒ
- **ç¨³å¥æ€§**: VIFæ£€éªŒã€Breusch-Paganæ£€éªŒ

---

## ğŸ“ˆ è¾“å‡ºç»“æœ

### ç»Ÿè®¡è¡¨æ ¼

1. **`heterogeneity_results.csv`**: å®Œæ•´å›å½’ç»“æœæ±‡æ€»
   - äº¤äº’é¡¹ç³»æ•°ã€æ ‡å‡†è¯¯ã€på€¼
   - æ¨¡å‹æ‹Ÿåˆåº¦æŒ‡æ ‡
   - æ˜¾è‘—æ€§æ ‡è®°

2. **`significant_interactions.json`**: æ˜¾è‘—äº¤äº’æ•ˆåº”è¯¦æƒ…
   - æ˜¾è‘—æ€§ç»Ÿè®¡æ‘˜è¦
   - æœ€å¼ºæ•ˆåº”è¯†åˆ«
   - è¾¹é™…æ•ˆåº”è®¡ç®—

3. **`full_regression_results.json`**: æ‰€æœ‰æ¨¡å‹å®Œæ•´ç»“æœ
   - ç³»æ•°ä¼°è®¡å€¼
   - ç½®ä¿¡åŒºé—´
   - æ¨¡å‹è¯Šæ–­æŒ‡æ ‡

### å¯è§†åŒ–å›¾è¡¨

1. **äº¤äº’æ•ˆåº”çƒ­åŠ›å›¾**: ç³»æ•°å¼ºåº¦çš„ç›´è§‚å±•ç¤º
2. **æ˜¾è‘—æ€§æ¦‚è§ˆå›¾**: å››è±¡é™ç»Ÿè®¡æ¦‚è§ˆ
3. **è¾¹é™…æ•ˆåº”å›¾**: æ¡ä»¶æ•ˆåº”å˜åŒ–è¶‹åŠ¿
4. **å›å½’è¯Šæ–­å›¾**: æ¨¡å‹é€‚ç”¨æ€§æ£€éªŒ
5. **æ‘˜è¦æŠ¥å‘Šå›¾**: å…³é”®å‘ç°æ€»ç»“

---

## ğŸ’¡ ç ”ç©¶æ„ä¹‰

### ç†è®ºè´¡çŒ®

1. **ä¸°å¯ŒDLIç†è®º**: æ­ç¤ºé”å®šæ•ˆåº”çš„ç½‘ç»œç»“æ„ä¾èµ–æ€§
2. **æ‹“å±•å¼‚è´¨æ€§åˆ†æ**: å»ºç«‹ç½‘ç»œæ‹“æ‰‘è°ƒèŠ‚æ•ˆåº”çš„å®è¯æ¡†æ¶
3. **æ·±åŒ–å› æœæœºåˆ¶**: ä»"æ˜¯å¦å­˜åœ¨"åˆ°"ä½•æ—¶æ›´å¼º"çš„é€’è¿›è®¤è¯†

### æ”¿ç­–å¯ç¤º

1. **ç½‘ç»œæ„è¯†**: æ”¿ç­–åˆ¶å®šéœ€è€ƒè™‘ç½‘ç»œç»“æ„å·®å¼‚
2. **ç²¾å‡†æ–½ç­–**: åŸºäºç½‘ç»œç‰¹å¾çš„å·®å¼‚åŒ–ç­–ç•¥
3. **é£é™©è¯„ä¼°**: ç½‘ç»œè„†å¼±æ€§çš„åŠ¨æ€ç›‘æµ‹

### æ–¹æ³•åˆ›æ–°

1. **æ ‡å‡†åŒ–æµç¨‹**: å»ºç«‹å¯å¤åˆ¶çš„å¼‚è´¨æ€§åˆ†ææ¡†æ¶
2. **æ¨¡å—åŒ–è®¾è®¡**: æ”¯æŒçµæ´»çš„å˜é‡ç»„åˆå’Œæ‰©å±•
3. **å¯è§†åŒ–ç³»ç»Ÿ**: å¤æ‚äº¤äº’æ•ˆåº”çš„ç›´è§‚è¡¨è¾¾

---

## ğŸ”§ æŠ€æœ¯è¦æ±‚

### Pythonä¾èµ–

**å¿…éœ€åŒ…**:
```
pandas >= 1.5.0
numpy >= 1.21.0
```

**ç»Ÿè®¡åˆ†æ** (æ¨è):
```
statsmodels >= 0.13.0
scipy >= 1.9.0
scikit-learn >= 1.1.0
```

**å¯è§†åŒ–** (æ¨è):
```
matplotlib >= 3.5.0
seaborn >= 0.11.0
```

### å®‰è£…ä¾èµ–

```bash
# åŸºç¡€ä¾èµ–
pip install pandas numpy

# å®Œæ•´åŠŸèƒ½
pip install statsmodels scipy scikit-learn matplotlib seaborn
```

---

## ğŸ“‹ ä½¿ç”¨ç¤ºä¾‹

### ç¨‹åºåŒ–è°ƒç”¨

```python
from data_loader import HeterogeneityDataLoader
from analysis import HeterogeneityAnalyzer
from visualizer import HeterogeneityVisualizer

# åˆ›å»ºåˆ†æç®¡é“
loader = HeterogeneityDataLoader()
analyzer = HeterogeneityAnalyzer()
visualizer = HeterogeneityVisualizer()

# åŠ è½½æ•°æ®
global_data, local_data = loader.create_analysis_dataset()

# è¿è¡Œåˆ†æ
global_results = analyzer.run_global_analysis(global_data)
local_results = analyzer.run_local_analysis(local_data)

# ç”ŸæˆæŠ¥å‘Š
results_table = analyzer.create_results_table()
significant = analyzer.get_significant_interactions()

# åˆ›å»ºå¯è§†åŒ–
visualizer.plot_interaction_heatmap(results_table)
visualizer.plot_significance_overview(results_table)
```

### è‡ªå®šä¹‰åˆ†æ

```python
# æŒ‡å®šç‰¹å®šå˜é‡
custom_config = {
    'dli_vars': ['dli_composite'],
    'global_vars': ['global_density', 'global_clustering'],
    'control_vars': ['gdp_log', 'trade_openness']
}

analyzer.run_global_analysis(global_data, **custom_config)
```

---

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ•°æ®æ–‡ä»¶æœªæ‰¾åˆ°**
   - æ£€æŸ¥å…¶ä»–æ¨¡å—æ˜¯å¦å·²è¿è¡Œå¹¶ç”Ÿæˆè¾“å‡º
   - ä½¿ç”¨æ¼”ç¤ºæ¨¡å¼æµ‹è¯•åŠŸèƒ½

2. **ç»Ÿè®¡åŒ…ç¼ºå¤±**
   - å®‰è£…statsmodels: `pip install statsmodels`
   - ä½¿ç”¨ç®€åŒ–å›å½’æ¨¡å¼

3. **å¯è§†åŒ–é”™è¯¯**
   - å®‰è£…matplotlib/seaborn: `pip install matplotlib seaborn`
   - æ£€æŸ¥ä¸­æ–‡å­—ä½“è®¾ç½®

4. **å†…å­˜ä¸è¶³**
   - å‡å°‘åˆ†æå˜é‡æ•°é‡
   - ä½¿ç”¨æ•°æ®å­é›†

### è°ƒè¯•æ¨¡å¼

```python
import logging
logging.basicConfig(level=logging.DEBUG)

# è¿è¡Œåˆ†ææŸ¥çœ‹è¯¦ç»†æ—¥å¿—
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### æ¨¡å—ç»´æŠ¤

- **è´Ÿè´£å›¢é˜Ÿ**: Energy Network Analysis Team
- **ç‰ˆæœ¬**: v1.0
- **æ›´æ–°æ—¥æœŸ**: 2025-08-17

### æ‰©å±•è¯´æ˜

æœ¬æ¨¡å—é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œæ”¯æŒï¼š
- è‡ªå®šä¹‰å˜é‡ç»„åˆ
- æ–°å¢ç½‘ç»œæŒ‡æ ‡
- æ‰©å±•å¯è§†åŒ–åŠŸèƒ½
- é›†æˆå…¶ä»–ç»Ÿè®¡æ–¹æ³•

### å¼•ç”¨æ ¼å¼

å¦‚åœ¨å­¦æœ¯ç ”ç©¶ä¸­ä½¿ç”¨æœ¬æ¨¡å—ï¼Œå»ºè®®å¼•ç”¨ï¼š
```
Energy Network Analysis Team (2025). Network Structure Heterogeneity Analysis Module. 
Version 1.0. https://github.com/your-repo/energy_network
```

---

## ğŸ”® æœªæ¥å‘å±•

### è®¡åˆ’åŠŸèƒ½

1. **æœºå™¨å­¦ä¹ é›†æˆ**: æ”¯æŒéçº¿æ€§äº¤äº’æ•ˆåº”æ£€æµ‹
2. **æ—¶é—´å¼‚è´¨æ€§**: åŠ å…¥æ—¶é—´ç»´åº¦çš„è°ƒèŠ‚æ•ˆåº”åˆ†æ
3. **ç©ºé—´å¼‚è´¨æ€§**: è€ƒè™‘åœ°ç†è·ç¦»çš„å½±å“
4. **å¤šå±‚ç½‘ç»œ**: æ‰©å±•åˆ°å¤šå±‚ç½‘ç»œç»“æ„

### æ–¹æ³•æ”¹è¿›

1. **å› æœè¯†åˆ«**: å¼•å…¥æ›´ä¸¥æ ¼çš„å› æœæ¨æ–­æ–¹æ³•
2. **ç¨³å¥æ€§æ£€éªŒ**: å¢åŠ æ›´å¤šç¨³å¥æ€§æµ‹è¯•
3. **æ•æ„Ÿæ€§åˆ†æ**: å‚æ•°æ•æ„Ÿæ€§çš„ç³»ç»Ÿè¯„ä¼°

---

*æœ¬æ¨¡å—æ˜¯èƒ½æºç½‘ç»œåˆ†æé¡¹ç›®çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä¸ºç†è§£DLIæ•ˆåº”çš„å¤æ‚æ€§å’Œæ¡ä»¶æ€§æä¾›äº†å¼ºæœ‰åŠ›çš„åˆ†æå·¥å…·ã€‚*